<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Login with Firebase</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-4 max-w-4xl">
        <div class="bg-white p-8 rounded-2xl shadow-xl">
            <div class="grid md:grid-cols-2 gap-10 items-center">
                <div class="text-center md:text-left">
                    <h1 class="text-4xl font-bold text-gray-800 mb-4">Welcome Back!</h1>
                    <p class="text-gray-600 mb-6">Sign in to access your account and explore a seamless and secure
                        authentication experience powered by Firebase.</p>

                    <div id="authContainer">
                        <div id="loginSection" class="space-y-4">
                            <button id="googleSignIn"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg inline-flex items-center justify-center transition-transform transform hover:scale-105">
                                <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentColor" d="M488 261.8C488 403.3 381.5 512 248 512A248 248 0 0 1 0 264C0 132.3 97.4 32 232 32c56.9 0 106 20.3 143.4 54.2L336 149.4c-28.3-25.2-67.4-42.2-111.4-42.2-86.2 0-155.2 67.4-160.7 152.4H488zM192 352c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"/></svg>
                                <span>Sign in with Google (Popup)</span>
                            </button>
                            <button id="googleSignInRedirect"
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg inline-flex items-center justify-center transition-transform transform hover:scale-105">
                                <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentColor" d="M488 261.8C488 403.3 381.5 512 248 512A248 248 0 0 1 0 264C0 132.3 97.4 32 232 32c56.9 0 106 20.3 143.4 54.2L336 149.4c-28.3-25.2-67.4-42.2-111.4-42.2-86.2 0-155.2 67.4-160.7 152.4H488zM192 352c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"/></svg>
                                <span>Sign in with Google (Redirect)</span>
                            </button>
                            <p class="text-xs text-gray-500 mt-3">If the popup is blocked, please use the redirect option.
                            </p>
                        </div>

                        <div id="userInfo" class="hidden text-center">
                            <img id="userAvatar" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-blue-500"
                                src="" alt="User Avatar">
                            <h3 id="userName" class="text-2xl font-bold text-gray-800"></h3>
                            <p id="userEmail" class="text-gray-600"></p>
                            <button id="signOut"
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg mt-6 transition-transform transform hover:scale-105">
                                Sign Out
                            </button>
                        </div>
                    </div>

                     <div id="loader" class="text-center hidden">
                        <svg class="animate-spin h-8 w-8 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2 text-gray-600">Loading...</p>
                    </div>


                    <div id="error" class="text-red-500 mt-4 text-center font-medium"></div>

                </div>

                <div class="hidden md:block">
                    <div class="bg-gray-200 h-full w-full flex items-center justify-center rounded-lg">
                        <svg class="w-48 h-48 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white p-8 rounded-2xl shadow-xl mt-8">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">How to Set Up Your Firebase Google Login</h2>
            <div class="space-y-6">
                <div class="flex items-start">
                    <div
                        class="flex-shrink-0 flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold">
                        1</div>
                    <p class="ml-4 text-gray-700">Go to the <a href="https://firebase.google.com/" target="_blank"
                            class="text-blue-600 font-semibold hover:underline">Firebase Console</a> and create a new
                        project.</p>
                </div>
                <div class="flex items-start">
                    <div
                        class="flex-shrink-0 flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold">
                        2</div>
                    <p class="ml-4 text-gray-700">In your project, click on "Add Firebase to your web app" (the
                        <code class="bg-gray-200 text-sm font-mono p-1 rounded"></></code> icon).
                    </p>
                </div>
                <div class="flex items-start">
                    <div
                        class="flex-shrink-0 flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold">
                        3</div>
                    <div class="ml-4 text-gray-700">
                        <p>Copy the `firebaseConfig` object and paste it into the <code
                                class="bg-gray-200 text-sm font-mono p-1 rounded">firebase-config.js</code> file.</p>
                        <pre
                            class="bg-gray-800 text-white p-4 rounded-lg mt-2 text-sm overflow-x-auto"><code>export const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID",
    measurementId: "YOUR_MEASUREMENT_ID"
};</code></pre>
                    </div>
                </div>
                <div class="flex items-start">
                    <div
                        class="flex-shrink-0 flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold">
                        4</div>
                    <p class="ml-4 text-gray-700">In the Firebase Console, go to <span
                            class="font-semibold">Authentication</span> from the left menu and click on the <span
                            class="font-semibold">Sign-in method</span> tab.</p>
                </div>
                <div class="flex items-start">
                    <div
                        class="flex-shrink-0 flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold">
                        5</div>
                    <p class="ml-4 text-gray-700">Click on <span class="font-semibold">Google</span> in the list of
                        providers, enable it, and save.</p>
                </div>
                <div class="flex items-start">
                    <div
                        class="flex-shrink-0 flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold">
                        6</div>
                    <p class="ml-4 text-gray-700">Under <span class="font-semibold">Authentication</span> &rarr; <span
                            class="font-semibold">Settings</span>, go to the <span class="font-semibold">Authorized
                            domains</span> section and add your domain. For local development, <code
                            class="bg-gray-200 text-sm font-mono p-1 rounded">localhost</code> is usually added by
                        default.</p>
                </div>
            </div>
        </div>
    </div>


    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, signInWithPopup, signInWithRedirect, getRedirectResult, signOut, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
        import { firebaseConfig } from "./firebase-config.js";

        // DOM elements
        const authContainer = document.getElementById('authContainer');
        const loader = document.getElementById('loader');
        const loginSection = document.getElementById('loginSection');
        const userInfo = document.getElementById('userInfo');
        const googleSignInBtn = document.getElementById('googleSignIn');
        const googleSignInRedirectBtn = document.getElementById('googleSignInRedirect');
        const signOutBtn = document.getElementById('signOut');
        const errorDiv = document.getElementById('error');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');

        // Show loader
        function showLoader() {
            authContainer.style.display = 'none';
            loader.style.display = 'block';
        }

        // Hide loader
        function hideLoader() {
            authContainer.style.display = 'block';
            loader.style.display = 'none';
        }

        // --- START DEBUG SCRIPT ---
        if (!firebaseConfig.apiKey || firebaseConfig.apiKey.includes("YOUR_API_KEY")) {
            console.error("ERROR: Firebase config is NOT populated. Please follow the setup instructions.");
            document.getElementById('error').textContent = "Configuration Error: Firebase API key is missing. Please follow the setup instructions to configure your project.";
            // disable buttons
            document.getElementById('googleSignIn').disabled = true;
            document.getElementById('googleSignInRedirect').disabled = true;
        } else {
            console.log("SUCCESS: Firebase config has been populated.");
        }
        // --- END DEBUG SCRIPT ---

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const analytics = getAnalytics(app);
        const provider = new GoogleAuthProvider();

        // Clear error messages
        function clearError() {
            errorDiv.textContent = '';
        }

        // Show error messages
        function showError(message) {
            errorDiv.textContent = message;
        }

        // Display user information
        function displayUser(user) {
            loginSection.style.display = 'none';
            userInfo.style.display = 'block';

            userAvatar.src = user.photoURL || 'https://via.placeholder.com/100';
            userName.textContent = user.displayName || 'No name provided';
            userEmail.textContent = user.email || 'No email provided';

            clearError();
            hideLoader();
        }

        // Hide user information
        function hideUser() {
            loginSection.style.display = 'block';
            userInfo.style.display = 'none';
            clearError();
            hideLoader();
        }

        // Handle redirect result
        getRedirectResult(auth).catch((error) => {
            console.error('Redirect result error:', error);
            showError(`Sign in failed: ${error.message}`);
        });


        // Google Sign In with Popup
        googleSignInBtn.addEventListener('click', async () => {
            try {
                clearError();
                showLoader();
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error('Popup sign in error:', error);
                if (error.code === 'auth/popup-blocked') {
                    showError('Popup blocked! Please use the redirect option or allow popups for this site.');
                } else {
                    showError(`Sign in failed: ${error.message}`);
                }
                hideLoader();
            }
        });

        // Google Sign In with Redirect
        googleSignInRedirectBtn.addEventListener('click', async () => {
            try {
                clearError();
                showLoader();
                await signInWithRedirect(auth, provider);
            } catch (error) {
                console.error('Redirect sign in error:', error);
                showError(`Sign in failed: ${error.message}`);
                hideLoader();
            }
        });

        // Sign Out
        signOutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                console.log('User signed out');
            } catch (error) {
                console.error('Sign out error:', error);
                showError(`Sign out failed: ${error.message}`);
            }
        });

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                displayUser(user);
            } else {
                hideUser();
            }
        });
    </script>
</body>

</html>